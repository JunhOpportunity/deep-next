# UI 로딩 및 스트리밍

UI 로딩과 스트리밍 모두 서버에서 데이터를 가져오는 과정에서 생기는 공백을 처리할 수 있는 대안들이다. 이것을 제대로 파악하기 위해서는 SSR(Server Side Rendering) 에 대한 이해가 필요하기 때문에 SSR에 대해서도 정리했다.

# SSR

SSR은 모든 데이터를 가져온 후에 페이지의 HTML을 렌더링 할 수 있다. 클라이언트에서는 React가 페이지의 모든 컴포넌트에 대한 코드를 받아온 뒤에 UI를 하이드레이션 할 수 있다.

이는 사용자에게 빠른 페이지를 표시할 수 있지만 표시되기 전까지 데이터를 가져오는 과정 때문에 속도가 느릴 수 있다. 이때 페이지의 HTML을 작은 단위로 나누어서 서버에서 클라이언트로 조금씩 보내주는 것이 스트리밍이다.

이를 통해 UI가 모든 데이터를 기다리지 않고 빠르게 화면을 표시할 수 있게된다.
게다가 스트리밍은 각 컴포넌트가 하나의 덩어리로 간주될 수 있어서 React의 컴포넌트 모델과 잘 작동한다.

우선순위가 높거나 데이터와 상관 없는 컴포넌트들이 먼저 전송되고 그 이후에 데이터를 순차적으로 받아오는 방식이다.

## SSR 작동 방식

> 데이터 → HTML 렌더링 → HTML/CSS/JS 전송 → 반응형이 아닌 인터페이스 표시 → React 하이드레이션
> 
1. 특정 페이지의 모든 데이터를 서버에서 가져온다
2. 서버는 페이지의 HTML을 렌더링한다.
3. 페이지의 HTML, CSS 및 JavaScript가 클라이언트로 전송됩니다.
4. 반응형이 아닌 UI가 생성된 HTML 및 CSS를 사용하여 표시한다.
5. React는 UI에 하이드레이션을 통해 반응형으로 만든다.

## UI 로딩

> React의 Suspense를 Next에서는 loading.js를 사용하여 쉽게 작성할 수 있다
> 

```jsx
export function Loading() {
  return <LoadingUi />
}
```

+) loading.js는 하위 항목들에도 자동으로 적용된다.

## 스트리밍

스트리밍은 TTFB(Time To First Byte)와 FCP(First Contentful Paint)를 줄일 수 있으므로 긴 데이터 요청으로 인해 페이지 렌더링이 차단되는 것을 방지하려는 경우 매우 유용하다고 한다.

참고로 스트리밍은 서버에서 렌더링되므로 SEO에 영향을 주지 않는다고 한다.